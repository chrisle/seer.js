/*
                                _
       ________  ___  _____    (_)____
      / ___/ _ \/ _ \/ ___/   / / ___/
     (__  )  __/  __/ /  _   / (__  )
_________/\___/\___/_/  (_)_/ /____/... .. .
                         /___/

        by: Chris Le - @iamchrisle
       & Seer Interactive 2011-2013
          -=[ Version 1.6.4 ]=-

              License: MIT

         Get the FULL source code:
    https://github.com/chrisle/seer.js

                More info:
 http://www.seerinteractive.com/seo-toolbox
*/
var SeerJs=SeerJs||{};SeerJs.Error=function(){var a=[],b=!1;return{internal:function(a){SeerJs.Error.set("Internal error: "+a);return a},set:function(c){b=!0;a.push(c);return c},hasOccurred:function(){return b},get:function(){return b?a.join(", "):!1},reset:function(){b=!1;a=[]}}}();
SeerJs.Http=function(){function a(a,b){return m=void 0==b?a:a+"?"+SeerJs.Utils.toQueryString(b)}function b(a,b){void 0==n[r]&&c();n[r]=n[r]+"&"+a.trim().urlencode()+"="+b.trim().urlencode()}function c(){n[r]=""}function d(){return void 0==n[w]&&void 0==n[t]?!0:!1}function e(a){void 0==a&&(a="get");switch(a){case "get":p.method="get";break;case "post":p.method="post";break;default:p.method="get"}}function f(a){p.payload=a}function h(a){switch(a){case "json":a="application/json; charset=utf-8";break;
case "xml":a="application/xml; charset=utf-8";break;case "html":a="text/html";break;case "bodytxt":a="text/html";break;default:a="application/xhtml+xml"}p.contentType=a}function l(){return p!={}?p:!1}function k(){o=!1==l()?UrlFetchApp.fetch(m):UrlFetchApp.fetch(m,l());return 200==o.getResponseCode()?!0:!1}function g(a,b){void 0==a&&(method="html");if(q)c=q?o:"("+o.getResponseCode().toString()+") "+o.getContentText();else switch(c=o.getContentText(),a){case "json":var c=Utilities.jsonParse(c);break;
case "xml":c=Xml.parse(c,!0);break;case "function":c=b(c);break}return null===c||void 0===c?x+" ("+a+")":c}var m,n={},p={},o="",q=!1,x="No data was returned",w="Pragma",t="Cache-Control",r="Cookie";return{getCookies:function(){return n[r]},setCookie:b,setCookies:function(a){for(key in a)b(key,a[key])},resetCookies:c,enableCache:function(){n[w]=void 0;n[t]=void 0},disableCache:function(){n[w]="no-cache";n[t]="no-cache"},isCacheEnabled:d,isCacheDisabled:function(){return!d()},getHeaders:function(){return n},
resetHeaders:function(){n={}},getAdvancedArgs:l,setContentType:h,setRequestMethod:e,setPayload:f,setOauthCfg:function(a){var b;b=UrlFetchApp.addOAuthService(a.service);b.setAccessTokenUrl(a.accessTokenUrl);b.setRequestTokenUrl(a.requestTokenUrl+"?scope="+a.scope);b.setAuthorizationUrl(a.authorizationUrl);b.setConsumerKey(a.key);b.setConsumerSecret(a.secret);p.oAuthServiceName=a.service;p.oAuthUseToken=a.authUseToken},setBasicAuth:function(a,b){var c=Utilities.base64Encode(a+":"+b);n.Authorization=
"Basic "+c;return c},getJson:function(b,c){if(void 0==b)return"Missing parameters";a(b,c);k();return g("json")},postJson:function(b,c,d){a(b,d);h("json");e("post");f(c);k();return g("json")},getXml:function(b,c){a(b,c);k();return g("xml")},postXml:function(b,c,e){a(b,e);h("xml");f(c);k();return g("xml")},responseHeaders:function(){return o.getHeaders()},fetch:function(b){a(b);k();return g("html")},fetchAs:function(b,c){a(b);k();return g(c)},fetchBlock:function(b,c){a(b);k();return g("function",c)}}}();
SeerJs.Settings=function(){return{get:function(a){SETTINGS_SHEET="Settings";var b=SpreadsheetApp.getActiveSpreadsheet(),c=b.getSheetByName(SETTINGS_SHEET);null==c&&(SeerJs.Error.set("Settings sheet not found. Created one for you."),b.insertSheet(SETTINGS_SHEET));b=c.getRange("A:B").getValues();for(c=0;c<b.length;c++)if(b[c][0].toUpperCase()==a.toUpperCase())return b[c][1];SeerJs.Error.set('Could not find the setting "'+a+'"');return!1}}}();function getSetting(a){return SeerJs.Settings.get(a)}
SeerJs.Test=function(){var a=[];return{add:function(b,c){a.push([b,c])},run:function(){for(var b=0,c=a.length;b<c;)console.log("Testing "+a[b][0]+" ..."),a[b][1](),b++;console.log("Ran "+b+" tests.")}}}();SeerJs.Url=function(a){var b=[],c;void 0!=a&&(c=a);return{addParams:function(a){for(index in a)void 0!=a[index]&&""!=a[index]&&b.push([index,a[index]])},toString:function(){for(var a=[],e=0,f=b.length;e<f;)a.push(b[e][0]+"="+b[e][1]),e++;return void 0!=c?c+"?"+a.join("&"):a.join("&")}}};
SeerJs.Utils=function(){return{toQueryString:function(a){var b=[];for(index in a)void 0!=a[index]&&b.push(index+"="+a[index]);return b.join("&")},isDate:function(a){a=new Date(a);return"NaN"==a.toString()||"Invalid Date"==a.toString()?!1:!0}}}();function isColumn(a){return isArray(a)&&isArray(a[0])?!0:!1}function isArray(a){return-1==a.constructor.toString().indexOf("Array")?!1:!0}function strToArray(a){return"string"==typeof a?[a]:a}
function jsonifyCol(a){for(var a=strToArray(a),b=[],c=a.length,d=0;d<c;d++)b.push(a[d][0]);return Utilities.jsonStringify(b)}function getMonday(a){var b=a.getDay(),b=a.getDate()-b+(0==b?-6:1);return new Date(a.setDate(b))}function isInFuture(a){return new Date>a?!1:!0}function dateToYMD(a){var b,c;b=""+a.getFullYear();c=""+(a.getMonth()+1);1==c.length&&(c="0"+c);a=""+a.getDate();1==a.length&&(a="0"+a);return b+"-"+c+"-"+a}
function ratioUp(a,b,c){c=!c?2:c;return Math.round(100*(a/b)*Math.pow(10,c))/Math.pow(10,c)}function percentDiff(a,b){return b/a-1}function isNumeric(){return"number"==typeof input}function rangeToUrlString(a){if(isArray(a)){for(var b=[],c=0;c<a.length;c++)b.push(encodeURIComponent(a[c]));return b.join(",")}return encodeURIComponent(a)}function hashToParam(a){var b=[];for(hash in a)b.push(hash+"="+a[hash]);return b.join("&")}
function stripUrlScheme(a){for(var a=strToArray(a),b=a.length,c=0,d=[];c<b;)d.push(a[c].replace(/http(s)?:\/\//gi,"")),c++;return d}function getDomainName(a){for(var a=strToArray(a),b,c=[],d=0;d<a.length;d++)url=a[d],b=RegExp(/((www)\.)?.*(\w+)\.([\w\.]{2,6})/),c.push([b.exec(url)[0].replace(/^http(s)?:\/\//i,"").replace(/^www\./i,"").replace(/\/.*$/,"")]);return c}
function parseUrl(a){var a=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(a),b="url,scheme,slash,host,port,path,query,hash".split(","),c,d=[];for(c=0;c<b.length;c+=1)d[b[c]]=a[c];return d}
function jsonStringify(a){var b=typeof a;if("object"!=b||null===a)return"string"==b&&(a='"'+a+'"'),""+a;var c,d,e=[],f=a&&a.constructor==Array;for(c in a)d=a[c],b=typeof d,a.hasOwnProperty(c)&&("string"==b?d='"'+d+'"':"object"==b&&null!==d&&(d=jQuery.stringify(d)),e.push((f?"":'"'+c+'":')+(""+d)));return(f?"[":"{")+(""+e)+(f?"]":"}")}Array.prototype.remove=function(a){a=this.indexOf(a);-1<a&&this.splice(a,1);return this};Array.prototype.each=function(a){for(var b=this.length,c=0;c<b;c++)a(this[c])};
SeerJs.groupBy=function(a,b){if(a.length<b)return[a];for(var c=a,d=!0,e=[];c.length>b;){var f=c.splice(b);d&&(e.push(c),d=!1);e.push(f);c=f}return e};Array.prototype.toObj=function(){for(var a={},b=0;b<this.length;b++)a[this[b]]="";return a};Array.prototype.transpose=function(){for(var a=0,b=this.length,c=[];a<b;)c.push([this[a]]),a++;return c};Array.prototype.toArray=function(){return this};Array.prototype.each=function(a){for(var b=0,c=this.length;b<c;)a(this[b]),b++};
Array.prototype.collect=function(a){for(var b=0,c=this.length,d=[],e;b<c;)e=a(this[b]),void 0!=e&&d.push(e),b++;return d};Array.prototype.googleFormat=function(){var a=0,b=0,c=this.length,d=[],e=[];for(b in this[0])e.push(b);for(d.push(e);a<c;){e=[];for(b in this[a])e.push(this[a][b]);a++;d.push(e)}return d};
Array.prototype.flatten=function flatten(){for(var b=[],c=0,d=this.length;c<d;c++){var e=Object.prototype.toString.call(this[c]).split(" ").pop().split("]").shift().toLowerCase();e&&(b=b.concat(/^(array|collection|arguments|object)$/.test(e)?flatten.call(this[c]):this[c]))}return b};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.stripNewline=function(){return this.replace(/\n|\r/g,"")};
String.prototype.stripMultiSpace=function(){return this.replace(/\s{2,}/g,"")};String.prototype.toArray=function(){return[this]};String.prototype.inQuotes=function(){return"'"+this+"'"};String.prototype.left=function(a){return 0>=a?"":a>(""+this).length?this:(""+this).substring(0,a)};String.prototype.right=function(a){if(0>=a)return"";if(a>(""+this).length)return this;var b=(""+this).length;return(""+this).substring(b,b-a)};
String.prototype.hasPathInURL=function(){return-1!=this.indexOf("http")?4<this.split("/").length?!0:!1:2<this.split("/").length?!0:!1};String.prototype.getDomainName=function(){regex=RegExp(/((www)\.)?.*(\w+)\.([\w\.]{2,6})/);return regex.exec(this)[0].replace(/^http(s)?:\/\//i,"").replace(/^www\./i,"").replace(/\/.*$/,"")};String.prototype.urlencode=function(){return encodeURIComponent(this)};
String.prototype.removeTags=function(a){return void 0===a?this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,""):this.replace(RegExp("(<("+a+"[^>]+)>)","ig"),"").replace(RegExp("(<(/"+a+"[^>]?)>)","ig"),"")};String.prototype.unescapeHTML=function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&#39;/g,"'")};String.prototype.contentInBodyTag=function(){return this.replace(/\n|\r/g,"").match(/\<body.*/)[0].replace(/\</gi," <").replace(/\<.*?\>/gi,"")};
String.prototype.extractBetween=function(a,b){var c=[],d=this.split(a),e=0,f=d.length;if(0<f){for(;e<f;){var h=d[e].indexOf(b);0<h&&(h=d[e].substr(0,h),"..."!=h&&c.push(h));e++}return 1==c.length?c[0].toString():c}return!1};String.prototype.stripAllSpaces=function(){return this.replace(/ /g,"")};
String.prototype.encodeGa=function(){var a=this.split("ga:"),b=0;for(len=a.length;b<len;)a[b]=a[b].trim().replace(/=/g,"%3D").replace(/>/g,"%3E").replace(/</g,"%3C").replace(/,\s{1,}/g,",").replace(/;\s{1,}/g,";").replace(/\s/,"%20"),b++;return a.join("ga:")};
SeerJs.GoogleAnalyticsTools={trackEvent:function(a,b,c,d,e,f){f=f||"_gaq";label=c||void 0;value=parseInt(d)||void 0;void 0===a&&SeerJs.Error.set("Category is required.");void 0===b&&SeerJs.Error.set("Action is required.");if(SeerJs.Error.hasOccurred())return SeerJs.Error.get();a=["_trackEvent".inQuotes(),a.inQuotes(),b.inQuotes()];void 0!=label&&a.push(label.inQuotes());void 0!=value&&a.push(value);return f+".push(["+a.join(",")+"]);"},outboundEventTracking:function(a,b,c,d){return['<a href="'+a+
'" onClick="'+trackEvent(c,"outboundClick",a)+(d?' target="_blank" ':"")+">"+b+"</a>",'getGaMetric(clientId, "totalEvents", startDate, endDate, ,"ga:eventCategory=='+c+',"ga:eventAction==outboundClick,"ga:eventLabel=='+a+'")']}};function createEventTrackingCode(a,b,c,d,e,f){return SeerJs.GoogleAnalyticsTools.trackEvent(a,b,c,d,e,f)}
SeerJs.GoogleScraper=function(){var a;return{get:function(b,c,d,e){var f;a=!1;try{f=UrlFetchApp.fetch("http://www.google"+(d||".com")+"/search?q="+b+"&start="+(e||0)+"&num="+(c||10)).getContentText()}catch(h){a=!0,f=h}if(a)b=f;else{b=f.replace(/\n|\r/g,"");c=b.match(/<li class=\"g\">(.*)<\/li>/gi).toString().split('<li class="g">');b=[];d=0;for(e=c.length;d<e;){f=c[d];var l=void 0;if(f.match(/\/url\?q=/)){var l=f.indexOf("?q=")+3,k=f.indexOf("&amp"),l=f.substr(l,k-l);f=""!=l?l:!1}else f=!1;f&&0==
f.indexOf("http")&&b.push(f);d++}c=0;d=b.length;for(e=[];c<d;)e.push([b[c]]),c++;b=e}return b}}}();function googleScraper(a,b,c,d){return SeerJs.GoogleScraper.get(a,b,c,d)}
SeerJs.GoogleSerpParser=function(a,b){function c(a,b,c){var d=[],a=a.split(b),b=0,k=a.length;if(0<k){for(;b<k;){var g=a[b].indexOf(c);0<g&&(g=a[b].substr(0,g),"..."!=g&&d.push(g));b++}return 1==d.length?d[0].toString():d}return!1}function d(a,b,c){var a=a.split(b),b=0,d=a.length;if(0<d)for(;b<d;)c(a[b]),b++}a=a.replace(/\n|\r/g,"");return{all:function(){var e=[];d(a.match(/<div id=\"res\"><div id=\"ires\"><ol>(.*)<\/ol><\/div><\/div>/)[1].toString(),'<li class="g">',function(a){if(a.length){var d;
d={title:c(a,'<h3 class="r">',"</h3>").removeTags().unescapeHTML(),url:c(a,"/url?q=","&amp;sa"),desc:c(a,'<div class="s">',"<div>").removeTags().unescapeHTML(),cite:c(a,"<cite>","</cite>").toString().removeTags().unescapeHTML(),bolded:c(a,"<b>","</b>").toString(),cache:"http:"+c(a,'"flc"> - <a href="','">Cached</a>')};b.showUniversal&&0===d.url.length&&(d.url="http://www.google.com/"+c(a,'<a href="/','">')[1]);a=d;0<a.url.length&&e.push(a)}});return e}}};
SeerJs.ArrayTransform=function(){return{filterColumns:function(a,b){var c;c=1==b.length?b[0]:b;if(void 0!=a[0].length&&0<a[0].length){var d=[],e=[],f=[];for(col in c)e.push(a[0].indexOf(c[col]));for(row in a){f=[];for(col in e)f.push(a[row][e[col]]);d.push(f)}}else for(row in d=[],e=[],d.push(c),a){e=[];for(col in c)e.push(a[row][c[col]]);d.push(e)}c=d;return 1==b.length?SeerJs.ArrayTransform.removeFirstRow(c):c},removeFirstRow:function(a){a.shift();return a},combineRange:function(a,b,c){void 0==
b&&(b=!1);void 0==c&&(c=!1);var d=[];if(!0==b)for(b=0;b<a.length;b++)for(var e=0;e<a[0].length;e++)d.push(a[b][e]);else for(e=0;e<a[0].length;e++)for(b=0;b<a.length;b++)d.push(a[b][e]);if(!1==c){a=[];for(c=0;c<d.length;c++)a.push([]),a[c].push(d[c])}else a=d;return a}}}();function filterColumns(a,b){return SeerJs.ArrayTransform.filterColumns(a,b)}function removeFirstRow(a){return SeerJs.ArrayTransform.removeFirstRow(a)}
function combineRange(a,b,c){return SeerJs.ArrayTransform.combineRange(a,b,c)}SeerJs.OnPage=function(){return{content:function(a){return SeerJs.Http.fetch(a).trim()},bodyText:function(a){return SeerJs.Http.fetch(a).contentInBodyTag()},bodyWordCount:function(a){a=SeerJs.Http.fetch(a).contentInBodyTag();return SeerJs.Error.hasOccurred()?SeerJs.Error.get():a.split(/[\s\t\n\r]+/g).length},detectUrl:function(){}}}();
function getOnPageContent(a){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.OnPage.content(a)}function getOnPageBodyText(a){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.OnPage.bodyText(a)}function getOnPageBodyWordCount(a){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.OnPage.bodyWordCount(a)}SeerJs.Redirection=function(){return{htaccessRedirect:function(a,b){return"Redirect 301 "+(parseUrl(a).path||"/")+" "+b}}}();
function createHtaccessRedirect(a,b){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.Redirection.htaccessRedirect(a,b)}function computeMD5(a){a=Utilities.computeDigest(Utilities.DigestAlgorithm.MD5,a);return Utilities.base64Encode(a)}function computeSHA1(a){a=Utilities.computeDigest(Utilities.DigestAlgorithm.SHA_1,a);return Utilities.base64Encode(a)}function computeSHA256(a){a=Utilities.computeDigest(Utilities.DigestAlgorithm.SHA_256,a);return Utilities.base64Encode(a)}
function computeSHA384(a){a=Utilities.computeDigest(Utilities.DigestAlgorithm.SHA_384,a);return Utilities.base64Encode(a)}function computeSHA512(a){a=Utilities.computeDigest(Utilities.DigestAlgorithm.SHA_512,a);return Utilities.base64Encode(a)}
SeerJs.GaApi=function(){function a(a,b){try{if("undefined"==typeof a)return"Email address missing";if("undefined"==typeof b)return"Password missing";if(0==a.length)return"Email address missing";if(0==b.length)return"Password missing";var b=encodeURIComponent(b),c;c=UrlFetchApp.fetch("https://www.google.com/accounts/ClientLogin",{method:"post",payload:"accountType=GOOGLE&Email="+a+"&Passwd="+b+"&service=analytics&Source=SEER_Interactive_1.0functions-1.0"}).getContentText();return c=c.slice(c.search("Auth=")+
5,c.length)}catch(h){return-1!=h.message.indexOf("CaptchaRequired")?"Complete CAPTCHA at http://www.google.com/accounts/"+h.message.slice(h.message.indexOf("CaptchaUrl=")+11,h.message.indexOf("Error=")-1):"Authentication failed ("+h.message+")"}}function b(a,b,f,h,l,k,g,m,n,p,o,q){try{h.getYear()}catch(x){return"Invalid start date"}try{l.getYear()}catch(w){return"Invalid end date"}try{if("undefined"==typeof a)return"Authentication token missing";if("undefined"==typeof b)return"Profile number missing";
if("undefined"==typeof f)return"Specify at least one metric";if(b!=parseInt(b))return"Invalid profile number";k="undefined"==typeof k?"":k;g="undefined"==typeof g?"":g;m="undefined"==typeof m?"":m;o="undefined"==typeof o?100:o;o="string"==typeof o?100:o;q="undefined"==typeof q?1:q;q="string"==typeof q?1:q;if(0==a.length)return"Authentication token missing";if(0==b.length)return"Profile number missing";if(0==f.length)return"Specify at least one metric";if(-1!=a.indexOf("Authentication failed"))return"Authentication failed";
var a=a.replace(/\n/g,""),t,r,u,v;u=10>h.getMonth()+1?"0"+(h.getMonth()+1):h.getMonth()+1;v=10>h.getDate()?"0"+h.getDate():h.getDate();t=h.getYear()+"-"+u+"-"+v;u=10>l.getMonth()+1?"0"+(l.getMonth()+1):l.getMonth()+1;v=10>l.getDate()?"0"+l.getDate():l.getDate();r=l.getYear()+"-"+u+"-"+v;if(t>r)return"Start date should be before end date";b="https://www.google.com/analytics/feeds/data?ids=ga:"+b+"&start-date="+t+"&end-date="+r+"&max-results="+o+"&start-index="+q;"ga:"!=f.slice(0,3)&&(f="ga:"+f);f=
f.replace(/&/g,"&ga:");f=f.replace(/ga:ga:/g,"ga:");f=f.replace(/&/g,"%2C");b=b+"&metrics="+f;0<g.length&&("ga:"!=g.slice(0,3)&&(g="ga:"+g),g=g.replace(/&/g,"&ga:"),g=g.replace(/ga:ga:/g,"ga:"),g=g.replace(/&/g,"%2C"),b=b+"&dimensions="+g);0<k.length&&("ga:"!=k.slice(0,3)&&(k="ga:"+k),k=k.replace(/,/g,",ga:"),k=k.replace(/;/g,";ga:"),k=k.replace(/ga:ga:/g,"ga:"),k=encodeURIComponent(k),b=b+"&filters="+k);"number"==typeof m&&(m="gaid::"+m);0<m.length&&(-1==m.indexOf("gaid::")&&-1==m.indexOf("dynamic::")&&
("ga:"!=m.slice(0,3)&&(m="ga:"+m),m="dynamic::"+m),m=encodeURIComponent(m),b=b+"&segment="+m);!0==n&&(b=b+"&sort=-"+f)}catch(B){return c(B.message)}try{var C=5E3*Math.random();Utilities.sleep(C);var y=UrlFetchApp.fetch(b,{method:"get",headers:{Authorization:"GoogleLogin auth="+a,"GData-Version":"2"}})}catch(z){if(-1!=z.message.indexOf("Timeout"))y=UrlFetchApp.fetch(b,{method:"get",headers:{Authorization:"GoogleLogin auth="+a,"GData-Version":"2"}});else return c(z.message)}try{var D=y.getContentText(),
A=Xml.parse(D).getElement().getElements("entry"),s,a=[],f=[],k=[],g=!0==p?1:0,m=0,n=!1;for(i=0;i<A.length;i++){m=0;s=A[i].getElements();for(j=0;j<s.length;j++)if("dimension"==s[j].getName().getLocalName()&&(f[m]=s[j].getAttribute("value").getValue(),1==g&&(k[m]=s[j].getAttribute("name").getValue()),m++),"metric"==s[j].getName().getLocalName())f[m]=Number(s[j].getAttribute("value").getValue()),1==g&&(k[m]=s[j].getAttribute("name").getValue()),m++;a[g]=f;f=[];n=!0;g++}if(!1==n)return"No data found";
!0==p&&(a[0]=k);return a}catch(E){return c(E.message)}}function c(a){var b=a.match(/<internalReason\b[^>]*>(.*?)<\/internalReason>/);return null==b?a:b[1]}GOOGLE_ANALYTICS_TOKEN=getSetting("Google Analytics Token");GOOGLE_ANALYTICS_USERNAME=getSetting("Google Analytics Username");GOOGLE_ANALYTICS_PASSWORD=getSetting("Google Analytics Password");return{metric:function(c,e,f,h,l,k,g,m,n,p,o){if(isInFuture(f))return"(Future date)";void 0==l&&(l="");void 0==k&&(k="");void 0==g&&(g="");void 0==m&&(m="");
void 0==n&&(n="");void 0==p&&(p="");void 0==o&&(o=!0);o&&Utilities.sleep(5E3*Math.random());GOOGLE_ANALYTICS_TOKEN.length||(GOOGLE_ANALYTICS_TOKEN=a(GOOGLE_ANALYTICS_USERNAME,GOOGLE_ANALYTICS_PASSWORD));return b(GOOGLE_ANALYTICS_TOKEN,c,"ga:"+e,f,h,l,k,g,m,n,p)},keywordCount:function(a,b,c){return getGaMetric(a,"visits",b,c,"","ga:keyword","","-ga:visits",!1,2E5).length}}}();
function getGaMetric(a,b,c,d,e,f,h,l,k,g){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.GaApi.metric(a,b,c,d,e,f,h,l,k,g)}function getGaKeywordCount(a,b,c){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.GaApi.keywordCount(a,b,c)}
SeerJs.GaAuth=function(){return{serviceAuthToken:function(a,b,c){void 0==c&&(c="analytics");try{var b=encodeURIComponent(b),d=UrlFetchApp.fetch("https://www.google.com/accounts/ClientLogin",{method:"post",payload:hashToParam({accountType:"GOOGLE",Email:a,Passwd:b,service:c,source:getSetting("Reported user agent")})}).getContentText();return d.slice(d.search("Auth=")+5,d.length)}catch(e){return-1!=e.message.indexOf("CaptchaRequired")?"Complete CAPTCHA at http://www.google.com/accounts/"+e.message.slice(e.message.indexOf("CaptchaUrl=")+
11,e.message.indexOf("Error=")-1):"Authentication failed ("+e.message+")"}}}}();function getGoogleServiceAuthToken_(a,b,c){return SeerJs.GaAuth.serviceAuthToken(a,b,c)}
SeerJs.KloutApi=function(){function a(a,c){return[c.twitter_id.getText(),c.score.kscore.getText(),c.score.slope.getText(),c.score.description.getText(),c.score.kclass_id.getText(),c.score.kclass.getText(),c.score.kclass_description.getText(),c.score.network_score.getText(),c.score.amplification_score.getText(),c.score.true_reach.getText(),c.score.delta_1day.getText(),c.score.delta_5day.getText()]}KLOUT_API_KEY=getSetting("Klout API Key");return{score:function(a){return filterColumns(getKlout(a),[["kscore"]])},
trueReach:function(a){return filterColumns(getKlout(a),[["true_reach"]],!1)},delta1:function(a){return filterColumns(getKlout(a),[["delta_1day"]],!1)},delta5:function(a){return filterColumns(getKlout(a),[["delta_5day"]],!1)},all:function(b){for(var b=strToArray(b),b=SeerJs.groupBy(b,5),c=[],d=0;d<b.length;d++){var e=b[d].join(","),e=SeerJs.Http.getXml("http://api.klout.com/1/users/show.xml",{key:KLOUT_API_KEY,users:e});c.push("twitter_id,kscore,slope,description,kclass_id,kclass,kclass_description,network_score,amplification_score,true_reach,delta_1day,delta_5day".split(","));
var f=e.users.user.length;if(1<f)for(var h=0;h<f;h++)c.push(a(c,e.users.user[h]));else c.push(a(c,e.users.user))}return c}}}();function getKloutScore(a){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.KloutApi.score(a)}function getKloutAll(a){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.KloutApi.all(a)}
SeerJs.MajesticApi=function(){function a(a){for(var b=[],c=l+1;c<a.length;c++)b.push(a[c]);return b}function b(a,b){var e=c(a,b);if("OK"==e.Result.code){var f=[],e=e.Result.DataTables.DataTable;if(void 0!=e.headers)f=d(f,e);else for(var g=0,h=e.length;g<h;)f=d(f,e[g]),g++;return f}SeerJs.Error.set("Error getting Majestic API: "+e.Result.errormessage);return!1}function c(a,b){return SeerJs.Http.getXml((g?f:h)+"?"+hashToParam({app_api_key:k,cmd:a,params:b}))}function d(a,b){a.push(b.headers.split("|"));
if(0<parseInt(b.rowscount))if(1==parseInt(b.rowscount))a.push(e(b.Row.getText().split("|")));else for(var c=b.Row,d=0;d<c.length;d++)a.push(e(c[d].getText().split("|")));return a}function e(a){for(var b=0,c=a.length,d=[];b<c;)d[b]=isNaN(a[b])?a[b]:parseInt(a[b]),b++;return d}var f="http://developer.majesticseo.com/api_command",h="http://enterprise.majesticseo.com/api_command",l=getSetting("Majestic backlinks limit"),k=getSetting("Majestic API key"),g=getSetting("Majestic enable development mode");
return{backLinks:function(a,c,d){d=d||l;if(a=b("GetTopBackLinks",hashToParam({URL:a,datasource:c,MaxSourceURLs:d,ShowDomainInfo:1,GetUrlData:1,GetSubDomainData:0,GetRootDomainData:0,MaxSourceURLsPerRefDomain:-1}))){c=[];for(d=0;d<l;d++)c.push(a[d]);a=c}else a=SeerJs.Error.get();return a},domainInfo:function(c,d,e){e=e||l;return a(b("GetTopBackLinks",hashToParam({URL:c,datasource:d,MaxSourceURLs:e,ShowDomainInfo:1,GetUrlData:1,GetSubDomainData:0,GetRootDomainData:0,MaxSourceURLsPerRefDomain:-1})))},
subdomainData:function(c,d,e){e=e||l;return a(b("GetTopBackLinks",hashToParam({URL:c,datasource:d,MaxSourceURLs:e,ShowDomainInfo:0,GetUrlData:1,GetSubDomainData:1,GetRootDomainData:0,MaxSourceURLsPerRefDomain:-1})))},rootDomain:function(c,d,e){e=e||l;return a(b("GetTopBackLinks",hashToParam({URL:c,datasource:d,MaxSourceURLs:e,ShowDomainInfo:0,GetUrlData:1,GetSubDomainData:0,GetRootDomainData:1,MaxSourceURLsPerRefDomain:-1})))},indexItemInfo:function(a){for(var a=a.toArray(),c="&items="+a.length,d=
0;d<a.length;d++)c=c+"&item"+d+"="+a[d];a=b("GetIndexItemInfo",c);return SeerJs.Error.get()||a},getMajesticTopBackLinks:function(a,c,d,e,f,g,h,k){return b("GetTopBackLinks",hashToParam({URL:a,datasource:c,MaxSourceURLs:d,ShowDomainInfo:e,GetUrlData:f,GetSubDomainData:g,GetRootDomainData:h,MaxSourceURLsPerRefDomain:k}))},subscriptionInfo:function(){return b("GetSubscriptionInfo")},maxBacklinksShown:function(){var a=c("GetSubscriptionInfo");return parseInt(a.Result.GlobalVars.standardreportbacklinksshown)}}}();
function getMajesticBackLinks(a,b,c){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.MajesticApi.backLinks(a,b,c)}function getMajesticDomainInfo(a,b,c){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.MajesticApi.domainInfo(a,b,c)}function getMajesticSubdomainData(a,b,c){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.MajesticApi.subdomainData(a,b,c)}
function getMajesticRootDomain(a,b,c){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.MajesticApi.rootDomain(a,b,c)}function getMajesticIndexItemInfo(a){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.MajesticApi.indexItemInfo(a)}function getMajesticGetMajesticTopBackLinks(a,b,c,d,e,f,h,l){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.MajesticApi.getMajesticTopBackLinks(a,b,c,d,e,f,h,l)}
function getMajesticSubscriptionInfo(){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.MajesticApi.subscriptionInfo()}function getMajesticMaxBacklinksShown(){return SeerJs.Error.hasOccurred()?SeerJs.Error.get():SeerJs.MajesticApi.maxBacklinksShown()}
SeerJs.RavenApi=function(){RAVEN_SECRET_KEY=getSetting("Raven secret key");return{rank:function(a,b,c,d,e){if(isInFuture(d))return"Date is in the future";var f;a:{f=["rank","url","status","date"];for(chk in f)if(f[chk]==e){f=!0;break a}f=!1}if(!f)return"Invalid data point";"string"==typeof optCols&&(optCols=[optCols]);a=SeerJs.Http.getJson("https://api.raventools.com/api",{key:RAVEN_SECRET_KEY,method:"rank",keyword:b,domain:a,start_date:dateToYMD(d),end_date:dateToYMD(d),engine:c,format:"json"});
return"rank"==e.toLowerCase()?"no data"==a[c][0].status?"No data":parseInt(a[c][0].rank):a[c][0][e]},allRank:function(a,b){if(isInFuture(b))return"Date is in the future";var c=SeerJs.Http.getJson("https://api.raventools.com/api",{key:RAVEN_SECRET_KEY,method:"rank_all",domain:a,start_date:dateToYMD(b),format:"json"}),d=[];d.push("keyword,engine,rank,status,date,url".split(","));for(keyword in c)for(engine in c[keyword]){if(void 0!=c[keyword][engine][0].rank)var e=c[keyword][engine][0].rank,f=c[keyword][engine][0].url;
status=c[keyword][engine][0].status;b=c[keyword][engine][0].date;d.push([keyword,engine,e,status,b,f])}return d},countKeywordsOnPage:function(a,b,c,d){if(isInFuture(b))return"n/a";for(var a=SeerJs.RavenApi.allRank(a,b),b=[0,0,0,0,0],e=1;e<a.length;e++){var f=a[e];f[1]==c.toLowerCase()&&(10>=f[2]&&b[1]++,10<f[2]&&20>=f[2]&&b[2]++,20<f[2]&&30>=f[2]&&b[3]++,30<f[2]&&b[4]++)}return b[d]},keywords:function(a){var b=[],a=SeerJs.Http.getJson("https://api.raventools.com/api",{key:RAVEN_SECRET_KEY,method:"keywords",
domain:a,format:"json"});for(keyword in a)b.push([a[keyword]]);return b},domains:function(){var a=[],b=SeerJs.Http.getJson("https://api.raventools.com/api",{key:RAVEN_SECRET_KEY,method:"domains",format:"json"});for(keyword in b)a.push([b[keyword]]);return a}}}();function getRavenRank(a,b,c,d,e){return SeerJs.RavenApi.rank(a,b,c,d,e)}function getRavenAllRank(a,b){return SeerJs.RavenApi.allRank(a,b)}function getRavenCountKeywordsOnPage(a,b,c,d){return SeerJs.RavenApi.countKeywordsOnPage(a,b,c,d)}
function getRavenKeywords(a){return SeerJs.RavenApi.keywords(a)}function getRavenDomains(){return SeerJs.RavenApi.domains()}
SeerJs.SeomozApi=function(){function a(a){isArray(a)?isColumn(a)&&(a=a[0]):a=strToArray(a);for(var b=0;b<a.length;b++)a[b]=a[b].toString().replace(/http(s)?:\/\//gi,"");return a}var b=SeerJs.Settings.get("SEOmoz Member ID"),c=SeerJs.Settings.get("SEOmoz Secret Key"),d={ut:"title",uu:"url",ueid:"external links",uid:"links",umrp:"mozrank",fmrp:"subdomain mozrank",us:"http status code",upa:"page authority",pda:"domain authority"};return{urlMetrics:function(e,f){void 0==f&&(f=!0);var h;h=(new Date).getTime();
h=Math.round(h/1E3)+1200;for(var l=[],k=!0,g,e=strToArray(e).flatten(),m=SeerJs.groupBy(a(e),10),n=0;n<m.length;n++){g=Utilities.jsonStringify(m[n]);var p=b,o=h,q;q=Utilities.computeHmacSignature(Utilities.MacAlgorithm.HMAC_SHA_1,b+"\n"+h,c);q=encodeURIComponent(Utilities.base64Encode(q));p={AccessID:p,Expires:o,Signature:q,Cols:103616137253};g={method:"post",payload:g};g=void 0!=g?"post"===g.method?SeerJs.Http.postJson("http://lsapi.seomoz.com/linkscape/url-metrics/",g.payload,p):void 0:SeerJs.Http.getJson("http://lsapi.seomoz.com/linkscape/url-metrics/",
p);p=[];o=[];for(key in d)o.push(d[key]);p.push(o);for(q=0;q<g.length;q++){o=[];for(key in d)o.push(g[q][key]);p.push(o)}g=p;!1==k&&g.shift();l.push.apply(l,g);k=!1}f||l.shift();return l}}}();function getLinkscape(a,b){return SeerJs.SeomozApi.urlMetrics(a,b)}
SeerJs.TwitterApi=function(){return{search:function(a,b,c){var c=c||["created_at","from_user","to_user","text"],b=b||25,b=void 0!=b?"&rpp="+b:"",d=encodeURIComponent(d),a=SeerJs.Http.getJson("http://search.twitter.com/search.json",{q:d+b});return 0==a.results.length?a.error:filterColumns(a.results,c)},userLookup:function(a,b){var c="location,created_at,favourites_count,url,id,followers_count,lang,verified,geo_enabled,description,time_zone,friends_count,statuses_count".split(","),b=b||c,c=isArray(a)?
a.join(","):a,c=SeerJs.Http.getJson("http://api.twitter.com/1/users/lookup.json",{screen_name:c});return filterColumns(c,b)}}}();function getTwitterUserLookup(a,b){return SeerJs.TwitterApi.userLookup(a,b)}function getTwitterSearch(a,b,c){return SeerJs.TwitterApi.search(a,b,c)};
